jQuery(function($){$.fn.extend({insertAtCaret:function(a){var b="undefined"!=typeof this[0].name?this[0]:this;if($.browser.msie)b.focus(),sel=document.selection.createRange(),sel.text=a,b.focus();else if($.browser.mozilla||$.browser.webkit){var c=b.selectionStart,d=b.selectionEnd,e=b.scrollTop;b.value=b.value.substring(0,c)+a+b.value.substring(d,b.value.length),b.focus(),b.selectionStart=c+a.length,b.selectionEnd=c+a.length,b.scrollTop=e}else b.value+=a,b.focus()},evalScripts:function(){var o=this;$("script",o).each(function(){eval(o.text||o.textContent||o.innerHTML||"")})}}),$.extend({createUploadIframe:function(a,b){var c,d="jUploadFrame"+a,e=$(d);return!window.ActiveXObject||"boolean"!=typeof b&&"string"!=typeof b||(c="boolean"==typeof b?"about:blink":b),e.parent(document.body).length?e.attr("src",c):e=$('<iframe style="position:absolute; top:-9999px; left:-9999px" />').attr({id:d,name:d}).attr("src",c).appendTo(document.body),e.get(0)},createUploadForm:function(a,b,c){var d="jUploadForm"+a,e=$(d),f=$("#"+b),g=f.clone();if(e.parent(document.body).length?e.html(""):e=$('<form  action="" method="POST" enctype="multipart/form-data" />').attr({id:d,name:d}).css({position:"absolute",top:"-1200px",left:"-1200px"}).appendTo(document.body),"object"==typeof c)for(var h in c)$('<input type="hidden" name="'+h+'" value="'+c[h]+'" />').appendTo(e);return f.attr("id","jUploadFile"+a).before(g).appendTo(e),e},ajaxFileUpload:function(a){a=$.extend({},$.ajaxSettings,a);var b=(new Date).getTime(),c=$.createUploadForm(b,a.fileElementId,"undefined"==typeof a.data?!1:a.data),d=$.createUploadIframe(b,a.secureuri),e="jUploadFrame"+b,f="jUploadForm"+b;$.active++,a.global&&!$.active&&$.event.trigger("ajaxStart");var g=!1,h={};a.global&&$.event.trigger("ajaxSend",[h,a]);var i=function(b){d=d?d:document.getElementById(e);try{d=d.contentWindow?d.contentWindow:d.contentDocument,h.responseText=d.document.body?d.document.body.innerHTML:null,h.responseXML=d.document.XMLDocument?d.document.XMLDocument:d.document}catch(f){alert(f)}if(h||"timeout"==b){g=!0;var i;try{if(i="timeout"!=b?"success":"error","error"!=i){var j=$.uploadHttpData(h,a.dataType);a.success&&a.success(e,j,i),a.global&&$.event.trigger("ajaxSuccess",[h,a])}else a.error?a.error(f):alert(f)}catch(k){alert(k)}a.global&&$.event.trigger("ajaxComplete",[h,a]),a.global&&!--$.active&&$.event.trigger("ajaxStop"),a.complete&&a.complete(h,i),$(d).unbind(),setTimeout(function(){try{$(d).remove(),$(c).remove()}catch(a){alert(a)}},100),h=null}};a.timeout>0&&setTimeout(function(){g||i("timeout")},a.timeout);try{var j=$("#"+f);j.attr({action:a.url,method:"POST",target:e}),j.attr(j.encoding?"encoding":"enctype","multipart/form-data"),j.submit()}catch(k){alert(k)}return $("#"+e).load(i),{abort:function(){}}},uploadHttpData:function(r,t){var v=t&&"xml"!=t?r.responseText:r.responseXML;return"script"==t&&$.globalEval(v),"json"==t&&eval("data = "+v),"html"==t&&$("<div>").html(v).evalScripts(),v}}),pidAjaxFileUpload=function(){return""===document.getElementById("Filedata").value?alert("no file")||!1:($('<img src="./common/img/msg.loading.gif" style="display:none;">').ajaxStart(function(){$(this).show()}).ajaxComplete(function(){$(this).hide()}).appendTo($("#fUloader").find(".fpv").empty()),$.ajaxFileUpload({url:"index.php?act=procFileIframeUpload",secureuri:!1,fileElementId:"Filedata",dataType:"html",data:{mid:current_mid,editor_sequence:"1",uploadTargetSrl:"",manual_insert:"true"},success:function(a,b,c){if("undefined"!=typeof b.error)alert(""!==b.error?b.error:b.msg);else{var d=document.getElementById(a);d=d.contentWindow?d.contentWindow:d.contentDocument,pidReloadFileList(d.uploaded_fileinfo.file_srl)}},error:function(a,b,c){alert(c)}}),!1)},pidReloadFileList=function(a){function b(b){var c,d,e,f,g,h,i,j,k,l=0;if(c=document.getElementById("siFf"),c.document_srl.value=b.upload_target_srl,j=b.files,k=$("#siFiles").empty(),$("#fUloader").find(".fpv").empty(),j&&j.length){for(d=0,l=j.length;l>d;d++)i=j[d],h=i.source_filename,g=i.download_url,e=i.file_srl,f=parseInt(i.file_size),f=f>1024?Math.round(f/1024)+"kb":f+"byte",$('<option id="sif'+e+'" value="'+e+'" data-src="'+g+'"></option>').appendTo(k).text(h+" ("+f+")").addClass(""!==g?"success":"error");void 0!==a&&a&&k.val(a)}$("#siFileCnt").text(l),$("#siFiles").change()}var c={mid:current_mid,editor_sequence:"1",upload_target_srl:""};exec_json("file.getFileList",c,b)},$("#fUloader:eq(0)").each(function(){pidReloadFileList(),$(".scFup",this).click(function(){return $(".fd").find("input[type=file]:first").trigger("click"),!1}),$(".scFcl",this).click(function(){var a=$("#siFiles").val();return a&&confirm("Do you want to delete a file?")&&exec_json("file.procFileDelete",{file_srls:a,editor_sequence:"1"},pidReloadFileList),!1}),$(".scFin",this).click(function(){var a=$("#siFiles").val();if(a){var b,c=$("#sif"+a).text(),d=$("#sif"+a).attr("data-src"),e=d||"";b=e.match(/\.(?:(jpe?g|png|gif))$/i)?'<img src="'+e+'" />':'<a href="'+e+'">'+c+"</a>",$("textarea[name=content]","#siFf").insertAtCaret(b),$("input[name=use_html]","#siFf").attr("checked","checked")}return!1}),$("#siFiles",this).change(function(){var a,b=$("#siFiles").val(),c=$("#sif"+b).attr("data-src"),d=c||"";a=d.match(/\.(?:(jpe?g|png|gif))$/i)?'<img src="'+d+'" />':d?'<img src="./modules/editor/tpl/images/files.gif" />':'<img src="./common/img/blank.gif" />',$(a).appendTo($("#fUloader").find(".fpv").empty())})})}),jQuery(function(a){String.prototype.pidUcfirst=function(){var a=this;return a.charAt(0).toUpperCase()+a.slice(1)},a.fn.pidDeclareBtninit=function(){this.click(function(){var b,c=a(this),d=c.attr("data-type"),e=c.attr("data-srl"),f=c.attr("data-rec")||"0",g={target_srl:e,cur_mid:current_mid,mid:current_mid};return b=prompt("Please describe the reasons.",""),"string"!=typeof b?!1:b.trim()?(exec_json(d+".proc"+d.pidUcfirst()+"Declare",g,function(a){if(alert(a.message),0===a.error){if("0"==f)return location.reload()||!1;var c="[Board DX] Declare, "+d+":"+e,g=current_url.setQuery("comment_srl",e);b=b+'<br /><br /><a href="'+g+'">'+g+"</a>";var h={receiver_srl:f,title:c,content:b};exec_json("communication.procCommunicationSendMessage",h,function(a){alert(a.message),location.reload()})}}),!1):alert("Please enter the message.")||!1})},a.fn.pidVoteBtninit=function(){this.click(function(){var b=a(this),c=b.attr("href"),d=b.attr("data-type"),e=b.attr("data-srl"),f={target_srl:e,cur_mid:current_mid,mid:current_mid};return exec_json(d+".proc"+d.pidUcfirst()+("#recommend"==c?"VoteUp":"VoteDown"),f,function(a){if(alert(a.message),0===a.error){var d=b.find("em.cnt");d.text((parseInt(d.text())||0)+("#recommend"==c?1:-1))}}),!1})},pidLoadPage=function(b,c,d){exec_json("beluxe.getBeluxeMobileCommentPage",{cpage:c,document_srl:b,clist_count:d,mid:current_mid},function(b){var c=a(b.html);a("#cl").remove(),a("#clpn").remove(),a("a.prev[data-page],a.next[data-page]",c).click(function(){var b=a(this).attr("data-srl"),c=a(this).attr("data-page"),d=a(this).attr("data-count");return pidLoadPage(b,c,d),!1}),a("a[href^=#][href$=recommend][data-type]",c).pidVoteBtninit(),a("a[href=#declare][data-type]",c).pidDeclareBtninit(),a("#clst").after(c)})},a("a[href=#declare][data-type]").pidDeclareBtninit(),a("a[href^=#][href$=recommend][data-type]").pidVoteBtninit(),a("#xe_message:eq(0)").each(function(){alert(a("p",this).text())}),a("#read:first").each(function(){var b=!1;a(".tgr[data-srl]").click(function(){if(!b){b=!0;var c=a(this).attr("data-srl"),d=a(this).attr("data-page"),e=a(this).attr("data-count");return pidLoadPage(c,d,e),!1}}),a(".co .mm").next().hide(),a(".mm").click(function(){return a(this).hide().next().show(),!1}),a(".tbn").click(function(){return a(this).next(".tgo").slideToggle("fast"),!1}),a(".tgr[data-load]").each(function(){a(this).click()})}),a("a[href=#categoryOpen]").click(function(){var b=a(".bd > .sd");return b.is(":hidden")?(b.width(0).show(),a(".bd > .st").animate({marginLeft:-250,marginRight:250},{step:function(b,c){a(".bd > .sd").width(b)}})):a(".bd > .st").animate({marginLeft:0,marginRight:0},{step:function(b,c){a(".bd > .sd").width(b)},complete:function(){b.hide()}}),!1}),a("li",".nav").each(function(){var b=a(".fr",this).width()||0;a("a",this).css("padding-right",b+10+"px")})});